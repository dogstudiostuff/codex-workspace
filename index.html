<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Code Clicker</title>
  <script src="https://unpkg.com/blockly/blockly.min.js"></script>
  <style>
    :root {
      color-scheme: light;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      margin: 0;
      background: #0f172a;
      color: #e2e8f0;
    }

    header {
      padding: 24px;
      background: linear-gradient(135deg, #2563eb, #7c3aed);
      text-align: center;
    }

    header h1 {
      margin: 0 0 8px;
      font-size: 2.2rem;
    }

    header p {
      margin: 0;
      opacity: 0.9;
    }

    .layout {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 16px;
      padding: 24px;
    }

    .panel {
      background: #111827;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.35);
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      margin: 16px 0;
    }

    .stat {
      padding: 12px;
      background: #1f2937;
      border-radius: 12px;
      text-align: center;
    }

    .stat span {
      display: block;
      font-size: 0.9rem;
      opacity: 0.7;
    }

    .stat strong {
      font-size: 1.5rem;
    }

    button {
      border: none;
      padding: 12px 18px;
      border-radius: 999px;
      font-weight: 600;
      cursor: pointer;
      background: #38bdf8;
      color: #0f172a;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 16px rgba(56, 189, 248, 0.35);
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .hint {
      background: #0b1120;
      padding: 12px 16px;
      border-left: 4px solid #38bdf8;
      border-radius: 8px;
      font-size: 0.95rem;
      line-height: 1.4;
    }

    #blocklyArea {
      height: 560px;
      width: 100%;
    }

    footer {
      text-align: center;
      padding: 16px 24px 32px;
      font-size: 0.9rem;
      opacity: 0.7;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Code Clicker</h1>
    <p>Click for code points, unlock Blockly blocks, and automate your way to bigger scores.</p>
  </header>

  <main class="layout">
    <section class="panel">
      <h2>Command Center</h2>
      <div class="stats">
        <div class="stat">
          <span>Code Points</span>
          <strong id="points">0</strong>
        </div>
        <div class="stat">
          <span>Points / Click</span>
          <strong id="pointsPerClick">1</strong>
        </div>
        <div class="stat">
          <span>Auto Clickers</span>
          <strong id="autoClickers">0</strong>
        </div>
      </div>
      <div class="actions">
        <button id="clickButton">Generate Code</button>
        <button id="runButton">Run My Blockly</button>
        <button id="resetButton">Reset Session</button>
      </div>
      <div class="stats">
        <div class="stat">
          <span>Unlocked Blocks</span>
          <strong id="unlocked">Starter Kit</strong>
        </div>
        <div class="stat">
          <span>Next Unlock</span>
          <strong id="nextUnlock">10 pts</strong>
        </div>
      </div>
      <p class="hint">
        Tip: Build a loop that calls <strong>add points</strong> or unlock a
        <strong>super clicker</strong> to scale faster. Each tier adds more Blockly blocks.
      </p>
    </section>

    <section class="panel">
      <h2>Blockly Lab</h2>
      <div id="blocklyArea"></div>
    </section>
  </main>

  <footer>
    Created in the Code Clicker lab â€” stack blocks, run code, and watch your points climb.
  </footer>

  <xml id="toolbox" style="display: none">
    <category name="Game Actions" colour="#38bdf8">
      <block type="add_points"></block>
    </category>
    <category name="Logic" colour="#f97316">
      <block type="controls_if"></block>
      <block type="logic_compare"></block>
    </category>
    <category name="Loops" colour="#22c55e">
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <shadow type="math_number">
            <field name="NUM">5</field>
          </shadow>
        </value>
      </block>
    </category>
    <category name="Math" colour="#eab308">
      <block type="math_number"></block>
      <block type="math_arithmetic"></block>
    </category>
  </xml>

  <script>
    const pointState = {
      points: 0,
      pointsPerClick: 1,
      autoClickers: 0,
      unlockTier: 0,
    };

    const unlocks = [
      {
        name: "Starter Kit",
        next: 10,
        unlock: () => {},
      },
      {
        name: "Auto Clicker",
        next: 25,
        unlock: () => {
          workspace.updateToolbox(`
            <xml>
              <category name="Game Actions" colour="#38bdf8">
                <block type="add_points"></block>
                <block type="start_auto_clicker"></block>
              </category>
              <category name="Logic" colour="#f97316">
                <block type="controls_if"></block>
                <block type="logic_compare"></block>
              </category>
              <category name="Loops" colour="#22c55e">
                <block type="controls_repeat_ext">
                  <value name="TIMES">
                    <shadow type="math_number">
                      <field name="NUM">5</field>
                    </shadow>
                  </value>
                </block>
              </category>
              <category name="Math" colour="#eab308">
                <block type="math_number"></block>
                <block type="math_arithmetic"></block>
              </category>
            </xml>
          `);
        },
      },
      {
        name: "Super Clicker",
        next: 60,
        unlock: () => {
          workspace.updateToolbox(`
            <xml>
              <category name="Game Actions" colour="#38bdf8">
                <block type="add_points"></block>
                <block type="start_auto_clicker"></block>
                <block type="upgrade_click"></block>
              </category>
              <category name="Logic" colour="#f97316">
                <block type="controls_if"></block>
                <block type="logic_compare"></block>
              </category>
              <category name="Loops" colour="#22c55e">
                <block type="controls_repeat_ext">
                  <value name="TIMES">
                    <shadow type="math_number">
                      <field name="NUM">5</field>
                    </shadow>
                  </value>
                </block>
                <block type="controls_whileUntil"></block>
              </category>
              <category name="Math" colour="#eab308">
                <block type="math_number"></block>
                <block type="math_arithmetic"></block>
              </category>
            </xml>
          `);
        },
      },
    ];

    const pointsLabel = document.getElementById("points");
    const pointsPerClickLabel = document.getElementById("pointsPerClick");
    const autoClickerLabel = document.getElementById("autoClickers");
    const unlockedLabel = document.getElementById("unlocked");
    const nextUnlockLabel = document.getElementById("nextUnlock");

    const workspace = Blockly.inject("blocklyArea", {
      toolbox: document.getElementById("toolbox"),
      grid: {
        spacing: 20,
        length: 3,
        colour: "#1f2937",
        snap: true,
      },
      zoom: {
        controls: true,
        wheel: true,
      },
      trashcan: true,
      theme: Blockly.Themes.Dark,
    });

    Blockly.defineBlocksWithJsonArray([
      {
        type: "add_points",
        message0: "add %1 code points",
        args0: [
          {
            type: "field_number",
            name: "AMOUNT",
            value: 1,
            min: 1,
          },
        ],
        previousStatement: null,
        nextStatement: null,
        colour: 200,
      },
      {
        type: "start_auto_clicker",
        message0: "start auto clicker (every %1 sec)",
        args0: [
          {
            type: "field_number",
            name: "SECONDS",
            value: 1,
            min: 0.5,
            max: 10,
            precision: 0.5,
          },
        ],
        previousStatement: null,
        nextStatement: null,
        colour: 190,
      },
      {
        type: "upgrade_click",
        message0: "upgrade click power by %1",
        args0: [
          {
            type: "field_number",
            name: "BOOST",
            value: 1,
            min: 1,
          },
        ],
        previousStatement: null,
        nextStatement: null,
        colour: 210,
      },
    ]);

    Blockly.JavaScript.forBlock["add_points"] = (block) => {
      const amount = Number(block.getFieldValue("AMOUNT")) || 0;
      return `addPoints(${amount});\n`;
    };

    Blockly.JavaScript.forBlock["start_auto_clicker"] = (block) => {
      const seconds = Number(block.getFieldValue("SECONDS")) || 1;
      return `startAutoClicker(${seconds});\n`;
    };

    Blockly.JavaScript.forBlock["upgrade_click"] = (block) => {
      const boost = Number(block.getFieldValue("BOOST")) || 1;
      return `upgradeClick(${boost});\n`;
    };

    function updateUI() {
      pointsLabel.textContent = pointState.points.toFixed(0);
      pointsPerClickLabel.textContent = pointState.pointsPerClick.toFixed(1);
      autoClickerLabel.textContent = pointState.autoClickers;
      unlockedLabel.textContent = unlocks[pointState.unlockTier]?.name ?? "All Unlocked";
      const nextUnlock = unlocks[pointState.unlockTier + 1];
      nextUnlockLabel.textContent = nextUnlock ? `${nextUnlock.next} pts` : "Maxed";
    }

    function addPoints(amount) {
      pointState.points += amount;
      checkUnlocks();
      updateUI();
    }

    function upgradeClick(boost) {
      pointState.pointsPerClick += boost;
      updateUI();
    }

    function startAutoClicker(seconds) {
      const interval = Math.max(0.5, Number(seconds)) * 1000;
      pointState.autoClickers += 1;
      setInterval(() => {
        addPoints(pointState.pointsPerClick);
      }, interval);
      updateUI();
    }

    function checkUnlocks() {
      const nextTier = unlocks[pointState.unlockTier + 1];
      if (!nextTier) {
        return;
      }
      if (pointState.points >= nextTier.next) {
        pointState.unlockTier += 1;
        nextTier.unlock();
      }
    }

    document.getElementById("clickButton").addEventListener("click", () => {
      addPoints(pointState.pointsPerClick);
    });

    document.getElementById("runButton").addEventListener("click", () => {
      const code = Blockly.JavaScript.workspaceToCode(workspace);
      const safeRunner = new Function(
        "addPoints",
        "startAutoClicker",
        "upgradeClick",
        `"use strict";\n${code}`
      );
      safeRunner(addPoints, startAutoClicker, upgradeClick);
    });

    document.getElementById("resetButton").addEventListener("click", () => {
      pointState.points = 0;
      pointState.pointsPerClick = 1;
      pointState.autoClickers = 0;
      pointState.unlockTier = 0;
      workspace.clear();
      workspace.updateToolbox(document.getElementById("toolbox"));
      updateUI();
    });

    updateUI();
  </script>
</body>
</html>
